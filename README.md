# PStudent

**PStudent Application**

Приложение PStudent — это проект на ASP.NET Core для управления студентами с использованием Razor Components и PostgreSQL в качестве базы данных. Приложение поддерживает запуск как в контейнерах Docker, так и локально без Docker.

---

## Используемые технологии и версии

- **.NET SDK:** 8.0  
- **ASP.NET Core:** 8.0  
- **Entity Framework Core:** 8.0.0  
- **PostgreSQL:** 15  
- **Docker:** версия >= 20.10  
- **Docker Compose:** версия >= 1.29  

---

## Основные библиотеки

- **Microsoft.EntityFrameworkCore** — для работы с базой данных.  
- **Microsoft.EntityFrameworkCore.Design** — для выполнения миграций.  
- **Npgsql.EntityFrameworkCore.PostgreSQL** — провайдер EF Core для PostgreSQL.  

---

## Системные требования

### Для запуска без Docker

- Установленный .NET SDK версии 8.0 или выше.  
- Установленный PostgreSQL версии 15 или выше.  
- ОС: Windows, Linux, macOS.  

### Для запуска через Docker

- Установленный Docker и Docker Compose.  
- Рекомендуемая ОС: Linux (Ubuntu), Windows 10/11 с WSL2 или macOS.  

---

## Установка и запуск

### 1. Запуск через Docker

**Шаги:**

1. Клонировать репозиторий:  
   `git clone <URL репозитория>`  
   `cd PStudent`

2. Собрать и запустить контейнеры:  
   `docker-compose up --build`

3. Открыть приложение:  
   После успешного запуска приложение будет доступно по адресу [http://localhost:5000](http://localhost:5000).

**Команды Docker Compose:**

- Пересборка контейнеров:  
  `docker-compose up --build`
- Остановка контейнеров:  
  `docker-compose down`
- Очистка остановленных контейнеров и неиспользуемых образов:  
  `docker system prune -f`

---

### 2. Запуск без Docker

**Шаги:**

1. Клонировать репозиторий:  
   `git clone <URL репозитория>`  
   `cd PStudent`

2. Настроить базу данных:  
   Убедитесь, что PostgreSQL запущен и настроен:  
   - Имя пользователя: `student_managment`  
   - Пароль: `student_managment`  
   - Имя базы данных: `student_managment`  
   - Порт: `5432`

3. Применить миграции:  
   Выполните команду для создания базы данных и применения миграций:  
   `dotnet ef database update --project PStudent.csproj`

4. Запустить приложение:  
   Выполните команду:  
   `dotnet run --project PStudent.csproj`

5. Открыть приложение:  
   Приложение будет доступно по адресу [http://localhost:5000](http://localhost:5000).

---

## Структура проекта

### Корневые файлы и папки

- **appsettings.json** — Главный файл конфигурации приложения. Здесь находятся настройки подключения к базе данных и параметры логирования.  
- **appsettings.Development.json** — Конфигурация для режима разработки, которая переопределяет настройки из `appsettings.json`.  
- **docker-compose.yml** — Конфигурация для сборки и запуска контейнеров Docker.  
- **Dockerfile.app** — Инструкция для создания Docker-образа приложения.  
- **Dockerfile.migrator** — Инструкция для создания Docker-образа, выполняющего миграции базы данных.  
- **Program.cs** — Точка входа приложения, где конфигурируются сервисы, маршруты и конвейер обработки HTTP-запросов.  
- **PStudent.csproj** — Файл конфигурации проекта, содержащий ссылки на пакеты и настройки сборки.  
- **migrate.sh** — Скрипт, выполняющий миграции базы данных внутри контейнера Docker.  

---

### Папка `Data`

- **AppDbContext.cs** — Контекст базы данных для Entity Framework Core. Этот класс управляет подключением к базе и доступом к сущностям.  
- **Student.cs** — Класс-сущность для представления данных о студентах.  

---

### Папка `Components`

Содержит компоненты Razor, которые составляют интерфейс приложения:

- **App.razor** — Главный компонент, определяющий макет и навигацию приложения.  
- **_Imports.razor** — Файл для подключения общих пространств имен, используемых во всех компонентах Razor.  

**Папка `Layout`:**
- **MainLayout.razor** — основной макет.

**Папка `Pages`:**
- **Home.razor** — Главная страница.  
- **Students.razor** — Страница для отображения студентов.  
- **AddStudentNew.razor** — Страница для добавления нового студента.  
- **EditStudent.razor** — Страница для редактирования информации о студенте.  
- Аналогично для групп, направлений и курсов: **Groups.razor**, **Directions.razor**, **Courses.razor** и соответствующие страницы добавления и редактирования.  

- **Routes.razor** — Файл маршрутов приложения.  

---

### Папка `Migrations`

- **20241127092443_InitialMigration.cs** — Первая миграция, создающая структуру базы данных.  
- **AppDbContextModelSnapshot.cs** — Снимок модели базы данных, используемый для сравнения при создании новых миграций.  

---

### Папка `Properties`

- **launchSettings.json** — Файл конфигурации для локального запуска приложения.  

---

### Папка `wwwroot`

- **app.css** — Стили приложения.  
- **bootstrap/** — Библиотека Bootstrap (если используется).  
- **favicon.png** — Иконка сайта.  

---

## Логика компонентов

1. **Компоненты страниц (Pages):**  
   Каждая страница отвечает за отображение данных или предоставление интерфейса для взаимодействия пользователя, например:  
   - **Students.razor** — отображает список студентов.  
   - **AddStudentNew.razor** — предоставляет форму для добавления нового студента.

2. **Контекст базы данных (AppDbContext):**  
   Используется для взаимодействия с таблицами базы данных через Entity Framework Core.  

3. **Миграции (Migrations):**  
   Содержат изменения структуры базы данных, управляемые EF Core.  

---

## Полезные команды

### EF Core

- **Создать миграцию:**  
  `dotnet ef migrations add <MigrationName> --project PStudent.csproj`
- **Применить миграции:**  
  `dotnet ef database update --project PStudent.csproj`
- **Удалить последнюю миграцию:**  
  `dotnet ef migrations remove --project PStudent.csproj`

---

## Частые ошибки и их решение

### Ошибка подключения к базе данных:  
**Npgsql.NpgsqlException: Failed to connect to 127.0.0.1:5432**  
- Убедитесь, что PostgreSQL запущен и доступен на указанном порту.  
- Проверьте правильность строки подключения в `appsettings.json` или переменных среды.

### Ошибка запуска контейнеров Docker:  
**ERROR: for db Cannot start service db: Ports are already in use**  
- Убедитесь, что порт 5432 или 9898 (для базы данных) не занят другими процессами.  
- Используйте команду:  
  `netstat -tuln | grep 5432` (Linux)  
  или  
  `Get-NetTCPConnection -LocalPort 5432` (Windows)  

### Приложение не доступно по адресу http://localhost:5000:  
- Проверьте, запущен ли контейнер приложения: `docker ps`.  
- Убедитесь, что приложение слушает на порту 5000. Проверьте настройки в `Program.cs` и `docker-compose.yml`.  

